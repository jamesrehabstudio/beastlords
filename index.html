<!doctype html>
<html>
<head>
	<title>Zombie Town</title>
	<meta name="description" content="A HTML 5 dom game" />
	   <link rel="stylesheet" href="css/style.css">
</head>
<body>
	<canvas id="" width="320" height="240"></canvas>
	<canvas id="game" width="960" height="720"></canvas>
	<div id="clearer"></div>
	<script src="//ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js" type="text/javascript"></script>
	<script src="js/game.js" type="text/javascript"></script>
	<script src="js/queue.js" type="text/javascript"></script>
	<script src="js/data.js" type="text/javascript"></script>
	<script src="js/polygons.js" type="text/javascript"></script>
	<script src="js/input.js" type="text/javascript"></script>
	
	<script src="js/objects.js" type="text/javascript"></script>
	
	
	<script src="http://planner.dev.rehabstudio.com/media/js/libs/deerc.js" type="text/javascript"></script>
	
	<script>
	window.onload = function() {
		window.dataManger = new DataManager();
		window.input = new Input();
		
		window.requestAnimationFrame = 
			window.requestAnimationFrame       || 
			window.webkitRequestAnimationFrame || 
			window.mozRequestAnimationFrame    || 
			window.oRequestAnimationFrame      || 
			window.msRequestAnimationFrame     || 
			null;
		
		load_sprites();
		
		dataManger.getLevel(function( res ){
			window.game = new Game( document.getElementById( 'game' ) );
			
			//window.game.renderCollisions = false;
			
			for( var i = 0; i < res.data.objects.length; i++ ){
				obj = res.data.objects[i];
				if ( window[obj.type] instanceof Function ) {
					temp = new window[obj.type](
						res.data.objects[i].x, 
						res.data.objects[i].y
					);
					temp.sprite = sprites[ res.data.objects[i].sprite ];
					try{
						var prop = decodeURI(res.data.objects[i].properties);
						temp.properties = JSON.parse(prop);
					} catch(err){console.log("failed to load properties", err);}
					window.game.addObject( temp );
				}
			}
			
			for( var i = 0; i < res.data.collisions.length; i++ ){
				var line = res.data.collisions[i];
				temp = new Line( 
					new Point( line.start_x, line.start_y ),
					new Point( line.end_x, line.end_y )
				);
				window.game.collisions.push( temp );
			}
			
			game.buildPaths();
			loop();
		}, window, "map0002" );
	}
	
	function kill(){
		for( var i = 0; i< game.objects.length;i++ ){
			if ( game.objects[i].team == 2){
				game.removeObject(game.objects[i]);
			}
		}
	}
	</script>
</body>